import streamlit as st
import pandas as pd
from streamlit_folium import st_folium

from src.limpieza import limpiar_datos, cargar_datos
from src.eda import accidentes_por_hora, accidentes_por_dia, accidentes_por_vehiculo
from src.mapas import mapa_calor

st.set_page_config(page_title="An치lisis de Accidentes de Tr치fico", layout="wide")

st.title("游뚿 An치lisis de Accidentes de Tr치fico en Espa침a")

# Cargar datos
st.sidebar.header("游늭 Datos")
archivo = st.sidebar.file_uploader("Sube un archivo CSV", type=["csv"])

if archivo:
    df = cargar_datos(archivo)
    df = limpiar_datos(df)

    st.subheader("Vista previa de los datos")
    st.dataframe(df.head())

    # Filtros
    st.sidebar.header("游꿑 Filtros")
    anios = st.sidebar.multiselect("A침o", sorted(df["anio"].unique()))
    meses = st.sidebar.multiselect("Mes", sorted(df["mes"].unique()))

    df_filtrado = df.copy()
    if anios:
        df_filtrado = df_filtrado[df_filtrado["anio"].isin(anios)]
    if meses:
        df_filtrado = df_filtrado[df_filtrado["mes"].isin(meses)]

    st.subheader("游늵 Gr치ficos")

    col1, col2 = st.columns(2)

    with col1:
        st.plotly_chart(accidentes_por_hora(df_filtrado), use_container_width=True)

    with col2:
        st.plotly_chart(accidentes_por_dia(df_filtrado), use_container_width=True)

    st.plotly_chart(accidentes_por_vehiculo(df_filtrado), use_container_width=True)

    st.subheader("游딬 Mapa de calor de accidentes")

    mapa = mapa_calor(df_filtrado)
    st_folium(mapa, width=900)
else:
    st.info("Sube un archivo CSV para comenzar.")
